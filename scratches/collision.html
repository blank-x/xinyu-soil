<!DOCTYPE html>

<html lang="en">

<head>
  <meta charset="UTF-8" />

  <meta name="viewport"
    content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0" />

  <meta http-equiv="X-UA-Compatible" content="ie=edge" />

  <title>Document</title>

  <style>
    .container {
      width: 200px;

      height: 200px;

      background: #00b7ff;

      position: relative;
    }

    .container div {
      width: 30px;

      height: 30px;

      border: 1px solid #2938e9;

      position: absolute;

      left: 0;

      top: 0;

      border-radius: 50%;
    }
  </style>
</head>

<body>
  <div class="container">
    <div>0</div>

    <div>1</div>

    <!-- <div>2</div>

    <div>3</div>

    <div>4</div>

    <div>5</div>

    <div>6</div>

    <div>7</div>

    <div>8</div>

    <div>9</div> -->

  </div>

  <button id="btn">sdsd</button>

  <script>
    const defaultInitialSize = 30;

    function getd({
      width = 200,
      height = 200,
      amount = 10,
      initialSize = defaultInitialSize,
      maxSize = 50,
    }) {
      const positions = [];

      const initPoss = [];

      const speed = 1;

      const rows = Math.floor(height / initialSize);

      const columns = Math.ceil(amount / rows);

      console.log(rows, columns);

      for (let i = 0; i < rows; i++) {
        for (let j = 0; j < columns; j++) {
          // 不越界

          if (i * columns + j >= amount) break;

          const deg = ((Math.random() * 90) / 180) * Math.PI;

          initPoss.push({
            x: initialSize / 2 + j * (initialSize + 5),
            y: initialSize / 2 + i * (initialSize + 5),
            r: initialSize / 2,
            rAdd: 0.1,
            speedX: speed * Math.cos(deg),
            speedY: speed * Math.sin(deg),
          });
        }
      }

      console.log(initPoss);

      return function getPos() {
        const map = {};
        for (let i = 0; i < initPoss.length; i++) {
          if (map[i]) continue;
          // 下一帧的位置x

          const nextX = initPoss[i].x + initPoss[i].speedX;

          // 下一帧的位置y

          const nextY = initPoss[i].y + initPoss[i].speedY;

          initPoss[i].x = nextX;

          initPoss[i].y = nextY;

          const temp = initPoss[i].r + 0.1;

          if (nextX < initPoss[i].r || nextX > width - temp) {
            initPoss[i].speedX = -initPoss[i].speedX;
            continue;
          }

          if (nextY < initPoss[i].r || nextY > height - temp) {
            initPoss[i].speedY = -initPoss[i].speedY;
            continue;
          }

          for (let j = i + 1; j < initPoss.length; j++) {
            if (map[j]) continue;

            const dis = Math.hypot(
              nextX - initPoss[j].x,
              nextY - initPoss[j].y
            );

            // 如果碰撞

            if (dis-2 < initPoss[i].r + initPoss[j].r) {
              debugger
              map[i] = true;
              map[j] = true;
              const temp1 = initPoss[i].speedX
              const temp2 = initPoss[i].speedY
              initPoss[i].speedX = initPoss[j].speedX;
              initPoss[j].speedX = temp1;
              initPoss[i].speedY = initPoss[j].speedY;
              initPoss[j].speedY = temp2;

              // if (initPoss[i].speedX * initPoss[j].speedX < 0) {
              //   initPoss[i].speedX = -initPoss[j].speedX;
              //   initPoss[j].speedX = -temp1;
              // } else if (initPoss[i].x - initPoss[j].x > 0) {
              //   initPoss[i].speedX = initPoss[j].speedX;
              //   initPoss[j].speedX = temp1;
              // }

              // if (initPoss[i].speedY * initPoss[j].speedY < 0) {
              //   initPoss[i].speedY = -initPoss[j].speedY;
              //   initPoss[j].speedY = -temp2;
              // } else {
              //   initPoss[i].speedY = initPoss[j].speedY;
              //   initPoss[j].speedY = temp2;
              // }
              break;
            }
          }
        }

        return initPoss;
      };
    }

    var getPos = getd({ initialSize: defaultInitialSize, amount:2 });

    const container = document.querySelector(".container");

    // const divs = [...container.children].slice(0, 2)

    const divs = [...container.children];

    let left1 = 0;

    let top1 = 0;

    let a = null;

    function draw() {
      const pos = getPos();

      divs.forEach((item, index) => {
        item.style.transform = `translate(${pos[index].x - defaultInitialSize / 2
          }px, ${pos[index].y - defaultInitialSize / 2}px)`;
      });

      a = setTimeout(() => {
        draw();
      }, 2000);
    }

    var isStop = true;

    btn.addEventListener("click", () => {
      if (isStop) {
        draw();
      } else {
        cancelAnimationFrame(a);
      }

      isStop = !isStop;
    });
  </script>
</body>

</html>